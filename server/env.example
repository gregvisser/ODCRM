# ============================================================================
# Backend Environment Variables
# ============================================================================
# Copy this file to .env for local development
# In production (Render), set these in the Render dashboard
# NEVER commit .env files with real credentials!

# ============================================================================
# DATABASE
# ============================================================================
# PostgreSQL connection string
# Local dev: postgresql://postgres:password@localhost:5432/odcrm
# Production (Neon): Get from https://console.neon.tech
DATABASE_URL="postgresql://postgres:password@localhost:5432/odcrm"

# ============================================================================
# SERVER CONFIGURATION
# ============================================================================
# Port - Render will set this automatically in production
PORT=3001

# Environment - "development" or "production"
NODE_ENV=development

# Frontend origin(s) for CORS - comma-separated list
# Local dev: http://localhost:5173
# Production: https://www.bidlow.co.uk
FRONTEND_URL=http://localhost:5173
FRONTEND_URLS=http://localhost:5173

# Public base URL for building upload links (optional)
# Example: https://api.bidlow.co.uk
API_PUBLIC_BASE_URL=

# ============================================================================
# PLACES / GEOSEARCH
# ============================================================================
# Base URL for UK place search (default uses OpenStreetMap Nominatim)
PLACES_API_BASE_URL=https://nominatim.openstreetmap.org/search
# User-Agent required by Nominatim usage policy
PLACES_API_USER_AGENT="ODCRM/1.0 (support@opensdoors.com)"

# ============================================================================
# MICROSOFT GRAPH / OUTLOOK OAUTH
# ============================================================================
# Get these from Azure App Registration
# See EMAIL_CAMPAIGNS_SETUP.md or AZURE_SETUP_GUIDE.md for instructions
MICROSOFT_CLIENT_ID=your-client-id-here
MICROSOFT_CLIENT_SECRET=your-client-secret-here
MICROSOFT_TENANT_ID=common

# OAuth callback URL
# Local dev: http://localhost:3001/api/outlook/callback
# Production: https://api.bidlow.co.uk/api/outlook/callback
REDIRECT_URI=http://localhost:3001/api/outlook/callback

# ============================================================================
# EMAIL TRACKING
# ============================================================================
# Domain for email tracking pixels and links
# Local dev: http://localhost:3001
# Production: https://api.bidlow.co.uk
EMAIL_TRACKING_DOMAIN=http://localhost:3001

# ============================================================================
# OPENAI API (for AI-powered features)
# ============================================================================
OPENAI_API_KEY=your-openai-api-key-here

# ============================================================================
# CLEARBIT API (for company enrichment)
# ============================================================================
CLEARBIT_API_KEY=your-clearbit-api-key-here

# ============================================================================
# ENV SOURCE (server only)
# ============================================================================
# Set ALLOW_ENV_LOCAL=true to load server/.env.local after .env (override DATABASE_URL).
# Default: only server/.env is loaded; .env.local is ignored (Azure DB as source of truth).
# ALLOW_ENV_LOCAL=false

# ============================================================================
# UI MODE (agency vs client)
# ============================================================================
# ODCRM_UI_MODE: "agency" | "client" (default: agency)
# - agency: multi-tenant; X-Customer-Id from request (no silent defaults).
# - client: single-tenant; tenant fixed by ODCRM_FIXED_CUSTOMER_ID.
# Client mode is disabled unless ODCRM_UI_MODE=client and ODCRM_FIXED_CUSTOMER_ID is set.
ODCRM_UI_MODE=agency

# ODCRM_FIXED_CUSTOMER_ID: only used when UI mode is client. When set with ODCRM_UI_MODE=client,
# all tenant-scoped requests are forced to this customer id; mismatching X-Customer-Id returns 403.
ODCRM_FIXED_CUSTOMER_ID=

# ============================================================================
# WORKER CONFIGURATION
# ============================================================================
# Control background jobs - set to "true" to disable specific workers

# Leads sync: set ENABLE_LEADS_SYNC=true to run worker. Worker only starts when
# DATABASE_URL host is Azure (.postgres.database.azure.com) or Neon (neon.tech).
# Disable leads sync worker (syncs from Google Sheets)
LEADS_SYNC_DISABLED=false
# Enable leads sync worker (must be "true"; worker runs only on Azure/Neon DB)
ENABLE_LEADS_SYNC=false
# Cron schedule for leads sync (default: every 10 minutes)
LEADS_SYNC_CRON=*/10 * * * *
# Lead metrics timezone for week boundaries (default: Europe/London)
# LEADS_METRICS_TIMEZONE=Europe/London

# Disable about/company enrichment worker
ABOUT_ENRICHMENT_DISABLED=false
# Cron schedule for enrichment (default: 2 AM daily)
ABOUT_ENRICHMENT_CRON=0 2 * * *

# Email sender batch configuration
SENDER_BATCH_SIZE=25
SENDER_LOCK_MINUTES=5
MAILBOX_DAILY_CAP=50
MAILBOX_SPREAD_HOURS=10

